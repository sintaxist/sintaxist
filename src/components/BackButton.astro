---
import ArrowIcon from "@/icons/Arrow.astro";

interface Props {
    lang: string; // Idioma actual
    info: string;
    className?: string;
}

const { lang, info, className = "" } = Astro.props;
const homePath = `/${lang}/`;
const projectsPath = `/${lang}/projects/`;
---

<a
    href={homePath}
    id="smart-back-button"
    data-lang={lang}
    class={`hidden text-xs md:text-sm relative font-secondary text-primary hover:text-primary-hover transition-colors font-bold w-fit group ${className}`}
>
    <ArrowIcon
        class="scale-[-1] w-4 h-4 transition-all group-hover:-translate-x-1"
    />
    {info}
</a>

<script>
document.addEventListener("astro:page-load", () => {
    const backButton = document.getElementById("smart-back-button");

    if (!backButton) return;

    backButton.addEventListener("click", (e) => {
        e.preventDefault();

        const lang = backButton.getAttribute("data-lang") || "es";
        const referrer = document.referrer;
        const currentPath = window.location.pathname;

        const homePath = `/${lang}/`;
        const projectsPath = `/${lang}/projects/`;

        // Caso: estamos en /projects/[slug]
        if (currentPath.startsWith(projectsPath) && currentPath !== projectsPath) {
            if (referrer.endsWith(homePath)) {
                window.location.href = projectsPath; // Volvemos a /projects/
            } else {
                window.location.href = projectsPath; // Siempre volver a /projects/
            }
            return;
        }

        // Caso: estamos en /projects/
        if (currentPath === projectsPath) {
            window.location.href = homePath; // Volvemos a home
            return;
        }

        // Cualquier otro caso, usar historial si existe
        if (window.history.length > 1) {
            window.history.back();
            return;
        }

        // Por defecto, ir al home
        window.location.href = homePath;
    });
});
</script>

<style>
#smart-back-button {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

#smart-back-button:before {
    content: "";
    width: 0;
    height: 2px;
    background-color: var(--color-primary);
    position: absolute;
    bottom: 0;
    left: 0;
    transition: width 0.3s ease-out;
}

#smart-back-button:hover:before {
    width: 100%;
}
</style>
