---
import ArrowIcon from "@/icons/Arrow.astro";

interface Props {
    defaultPath?: string;
    info: string;
    className?: string;
}

const { defaultPath = "/", info, className = "" } = Astro.props;
---

<a
    href={defaultPath}
    id="smart-back-button"
    data-default-path={defaultPath}
    class={`hidden text-xs md:text-sm relative font-secondary text-primary hover:text-primary-hover transition-colors font-bold w-fit group ${className}`}
>
    <ArrowIcon
        class="scale-[-1] w-4 h-4 transition-all group-hover:-translate-x-1"
    />
    {info}
</a>

<script>
document.addEventListener("astro:page-load", () => {
    const backButton = document.getElementById("smart-back-button");

    if (backButton) {
        backButton.addEventListener("click", (e) => {
            e.preventDefault();

            const defaultPath = backButton.getAttribute("data-default-path") || "/";
            const referrer = document.referrer;
            const hasHistory = window.history.length > 1;

            if (hasHistory && referrer) {
                try {
                    const referrerURL = new URL(referrer);
                    const comesFromSameSite = referrerURL.origin === window.location.origin;

                    // Si viene del mismo sitio y NO es "projects", vamos atrás
                    if (comesFromSameSite && !referrerURL.pathname.includes("/projects")) {
                        window.history.back();
                        return;
                    }
                } catch (err) {
                    console.warn("Error parsing referrer URL:", err);
                }
            }

            // Si no hay historial válido o viene de projects, ir al defaultPath
            window.location.href = defaultPath;
        });
    }
});
</script>

<style>
#smart-back-button {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

#smart-back-button:before {
    content: "";
    width: 0;
    height: 2px;
    background-color: var(--color-primary);
    position: absolute;
    bottom: 0;
    left: 0;
    transition: width 0.3s ease-out;
}

#smart-back-button:hover:before {
    width: 100%;
}
</style>
