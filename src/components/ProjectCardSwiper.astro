---
import ArrowIcon from "@/icons/Arrow.astro";

interface Project {
  slug: string;
  title: string;
  imgSrc: string;
  description: string;
}

interface Props {
  project: Project;
  lang: string;
  size?: string;
  categories?: object;
}

const { project, lang, size = "small" } = Astro.props;
const isLarge = size === "large";
---

<a
  href={`/${lang}/projects/${project.slug}/`}
  class="project-card swiper-slide group block text-secondary h-full min-h-[450px] relative overflow-hidden rounded-lg"
  transition:name={project.slug}
>
  <article class="skeleton-wrapper relative overflow-hidden w-full h-full">
    <img
      src={project.imgSrc}
      alt={`Imagen del proyecto ${project.title}`}
      width={isLarge ? 800 : 400}
      height={isLarge ? 600 : 300}
      loading="lazy"
      class="project-image w-full h-full object-cover group-hover:scale-110"
      onload="this.classList.add('loaded')"
    />

    <div class="skeleton-overlay" aria-hidden="true"></div>

    <div
      class={`w-full absolute backdrop-blur-sm backdrop-filter bg-gradient-to-t bottom-0 box-border content-stretch flex flex-col from-[#2c3a47] from-[0%] gap-2 items-start left-0 p-6 to-[rgba(44,58,71,0)] to-[124.76%] z-30`}
    >
      <h3
        class:list={[
          "font-primary",
          isLarge ? "text-2xl sm:text-3xl" : "text-2xl",
        ]}
      >
        {project.title}
      </h3>
      {
        project.description && (
          <p
            class="line-clamp-2 font-secondary text-sm"
            title={project.description}
            aria-label={project.description}
          >
            {project.description}
          </p>
        )
      }
      <div
        class="view-more-link flex items-center gap-2 font-secondary mt-[10px]"
      >
        <p class="underline">Ver m√°s</p>
        <ArrowIcon class="hidden xs:block" />
      </div>
    </div>
  </article>
</a>

<style>
  .project-card .skeleton-wrapper {
    position: relative;
    overflow: hidden;
  }
  .project-card img.project-image {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0;
    transition: all 0.3s;
    z-index: 10;
  }
  .project-card img.project-image.loaded {
    opacity: 1;
  }

  .project-card .skeleton-overlay {
    position: absolute;
    inset: 0;
    z-index: 20;
    background: linear-gradient(
      90deg,
      #234c91 0%,
      rgba(35, 76, 145, 0.85) 25%,
      rgba(35, 76, 145, 0.6) 50%,
      rgba(35, 76, 145, 0.85) 75%,
      #234c91 100%
    );
    background-size: 1000px 100%;
    animation: shimmer 1.8s linear infinite;
    will-change: background-position, opacity;
  }

  @keyframes shimmer {
    0% {
      background-position: -1000px 0;
    }
    100% {
      background-position: 1000px 0;
    }
  }

  .project-card img.project-image.loaded + .skeleton-overlay {
    opacity: 0;
    visibility: hidden;
    transition:
      opacity 0.3s ease-out,
      visibility 0.3s ease-out;
    animation: none;
  }
</style>
