---
import Pill from "@/components/ui/Pill.astro";
import ArrowIcon from "@/icons/Arrow.astro";

interface Props {
  project: object,
  lang: string,
  isLarge?: boolean,
  categories?: object,
  index?: number,
  className?: string
}

const { project, lang, isLarge = "small", categories, index, className } = Astro.props;
---

<a
  href={`/${lang}/projects/${project.slug}/`}
 
  class:list={[
    "project-card group block text-secondary overflow-hidden anim-item",
    className,
    { "is-large-card": isLarge },
  ]}
  transition:name={project.slug}
  data-astro-prefetch
  data-animation-type="card"
  data-delay={index * 200}
  data-animate="text"
>
  <article class="skeleton-wrapper relative overflow-hidden w-full h-full">
    <img
      src={project.imgSrc}
      alt={`Imagen del proyecto ${project.title}`}
      width={isLarge ? 800 : 400}
      height={isLarge ? 600 : 300}
      loading="lazy"
      class="project-image w-full h-full object-cover transition-all group-hover:scale-110"
      onload="this.classList.add('loaded')"
    />

    <div class="skeleton-overlay" aria-hidden="true"></div>

    <div
      class="absolute backdrop-blur-xs backdrop-filter bg-gradient-to-t bottom-0 box-border content-stretch flex flex-col from-[#2c3a47] from-[15%] gap-2 items-start left-0 p-4 sm:p-6 to-[rgba(44,58,71,0)] to-[120%] transition-all w-full -mb-[40px] sm:-mb-[45px] group-hover:-mb-0 z-30"
    >
      <div class="hidden lg:flex flex-wrap gap-2">
        {
          project.categoryIds.map((tag, tagIndex) => (
            <Pill label={categories[tag] || tag} index={tagIndex} />
          ))
        }
      </div>
      <h3
        class:list={[
          "font-primary",
          isLarge ? "text-xl sm:text-2xl md:text-3xl" : "text-lg sm:text-xl md:text-2xl",
        ]}
      >
        {project.title}
      </h3>
      {
        isLarge && project.description && (
          <p class="font-secondary text-base line-clamp-2">
            {project.description}
          </p>
        )
      }
      <div class="view-more-link flex items-center gap-2 font-secondary mt-2">
        <p class="text-base text-bold underline">{project.viewMore}</p>
        <ArrowIcon class="hidden xs:block w-4 h-4" />
      </div>
    </div>
  </article>
</a>

<style>
  .project-card {
    cursor: pointer;
  }

  .project-card[style*="pointer-events: none"] {
    cursor: default;
  }

  .project-card .skeleton-wrapper {
    position: relative;
    overflow: hidden;
  }

  .project-card img.project-image {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0;
    z-index: 10;
  }

  .project-card img.project-image.loaded {
    opacity: 1;
  }

  .group:hover .project-image {
    transform: scale(1.1);
  }

  .project-card .skeleton-overlay {
    position: absolute;
    inset: 0;
    z-index: 20;
    background: linear-gradient(
      90deg,
      #234c91 0%,
      rgba(35, 76, 145, 0.85) 25%,
      rgba(35, 76, 145, 0.6) 50%,
      rgba(35, 76, 145, 0.85) 75%,
      #234c91 100%
    );
    background-size: 1000px 100%;
    animation: shimmer 1.8s linear infinite;
    pointer-events: none;
  }

  @keyframes shimmer {
    0% {
      background-position: -1000px 0;
    }
    100% {
      background-position: 1000px 0;
    }
  }

  .project-card img.project-image.loaded + .skeleton-overlay {
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease-out, visibility 0.3s ease-out;
    animation: none;
  }

  .view-more-link {
    opacity: 0;
    transform: translateY(10px);
    overflow: hidden;
    transition: all 0.3s ease-in-out;
  }

  .group:hover .view-more-link {
    opacity: 1;
    transform: translateY(0);
  }

  @media (max-width: 768px) {
    .project-card:hover {
      transform: none;
    }
    
    .view-more-link {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>